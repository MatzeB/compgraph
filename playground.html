<html>
  <head>
    <meta charset="utf-8"/>
    <link rel="stylesheet" href="graph.css">
    <link rel="stylesheet" href="playground.css">
  </head>
  <body>
    <!-- imported layout.svg here (is there a better way?) -->
    <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" width="0" height="0">
      <defs>
        <marker id="arrow" refX="10" refY="5"
                markerWidth="10" markerHeight="10" orient="auto-start-reverse"
                markerUnits="userSpaceOnUse">
          <path d="M0,0 L10,5 L0,10 L2.5,5 z"/>
        </marker>
      </defs>
    </svg>

    <svg width="1000" height="700" viewBox="-100 150 1500 700" id="canvas">
      <g class="layout" style="--layout-ranksep: 35; layout-nodesep: 15">
        <text id="5th">5th Edition</text>
        <text id="6th">6th Edition</text>
        <text id="7th">7th Edition</text>
        <text id="8th">8th Edition</text>
        <text id="9th">9th Edition</text>
        <text id="pwb1">PWB 1.0</text>
        <text id="pwb12">PWB 1.2</text>
        <text id="pwb2">PWB 2.0</text>
        <text id="usg1">USG 1.0</text>
        <text id="usg2">USG 2.0</text>
        <text id="usg3">USG 3.0</text>
        <text id="cbu1">CB Unix 1</text>
        <text id="cbu2">CB Unix 2</text>
        <text id="cbu3">CB Unix 3</text>
        <text id="lsx">LSX</text>
        <text id="minu">Mini Unix</text>
        <text id="woll">Wollongong</text>
        <text id="inter">Interdata</text>
        <text id="1bsd">1 BSD</text>
        <text id="2bsd">2 BSD</text>
        <text id="28bsd">2.8 BSD</text>
        <text id="29bsd">2.9 BSD</text>
        <text id="3bsd">3 BSD</text>
        <text id="4bsd">4 BSD</text>
        <text id="41bsd">4.1 BSD</text>
        <text id="42bsd">4.2 BSD</text>
        <text id="43bsd">4.3 BSD</text>
        <text id="ts1">Unix/TS 1.0</text>
        <text id="ts+">Unix/TS++</text>
        <text id="ts3">Unix/TS 3.0</text>
        <text id="ts4">TS 4.0</text>
        <text id="sys0">System V.0</text>
        <text id="sys2">System V.2</text>
        <text id="sys3">System V.3</text>
        <text id="pdp11">PDP-11 Sys V</text>
        <text id="32v">32V</text>
        <text id="v7m">V7M</text>
        <text id="ultrix">Ultrix-11</text>
        <text id="ultrix32">Ultrix-32</text>
        <text id="xenix">Xenix</text>
        <text id="uniplus">UniPlus+</text>

        <path class="edge" src="5th" dst="6th"/>
        <path class="edge" src="5th" dst="pwb1"/>
        <path class="edge" src="6th" dst="1bsd"/>
        <path class="edge" src="6th" dst="inter"/>
        <path class="edge" src="6th" dst="lsx"/>
        <path class="edge" src="6th" dst="minu"/>
        <path class="edge" src="6th" dst="woll"/>
        <path class="edge" src="inter" dst="ts3"/>
        <path class="edge" src="inter" dst="pwb2"/>
        <path class="edge" src="inter" dst="7th"/>
        <path class="edge" src="7th" dst="8th"/>
        <path class="edge" src="7th" dst="32v"/>
        <path class="edge" src="7th" dst="v7m"/>
        <path class="edge" src="7th" dst="ultrix"/>
        <path class="edge" src="7th" dst="xenix"/>
        <path class="edge" src="7th" dst="uniplus"/>
        <path class="edge" src="v7m" dst="ultrix"/>
        <path class="edge" src="8th" dst="9th"/>
        <path class="edge" src="1bsd" dst="2bsd"/>
        <path class="edge" src="2bsd" dst="28bsd"/>
        <path class="edge" src="28bsd" dst="ultrix"/>
        <path class="edge" src="28bsd" dst="29bsd"/>
        <path class="edge" src="32v" dst="3bsd"/>
        <path class="edge" src="3bsd" dst="4bsd"/>
        <path class="edge" src="4bsd" dst="41bsd"/>
        <path class="edge" src="41bsd" dst="42bsd"/>
        <path class="edge" src="41bsd" dst="28bsd"/>
        <path class="edge" src="41bsd" dst="8th"/>
        <path class="edge" src="42bsd" dst="43bsd"/>
        <path class="edge" src="42bsd" dst="ultrix32"/>
        <path class="edge" src="pwb1" dst="pwb12"/>
        <path class="edge" src="pwb1" dst="usg1"/>
        <path class="edge" src="pwb12" dst="pwb2"/>
        <path class="edge" src="usg1" dst="cbu1"/>
        <path class="edge" src="usg1" dst="usg2"/>
        <path class="edge" src="cbu1" dst="cbu2"/>
        <path class="edge" src="cbu2" dst="cbu3"/>
        <path class="edge" src="cbu3" dst="ts+"/>
        <path class="edge" src="cbu3" dst="pdp11"/>
        <path class="edge" src="usg2" dst="usg3"/>
        <path class="edge" src="usg3" dst="ts3"/>
        <path class="edge" src="pwb2" dst="ts3"/>
        <path class="edge" src="ts1" dst="ts3"/>
        <path class="edge" src="ts3" dst="ts4"/>
        <path class="edge" src="ts+" dst="ts4"/>
        <path class="edge" src="cbu3" dst="ts4"/>
        <path class="edge" src="ts4" dst="sys0"/>
        <path class="edge" src="sys0" dst="sys2"/>
        <path class="edge" src="sys2" dst="sys3"/>
      </g>
    </svg>

    <div id="settings">
      <div class="setting">
        <label for="debug_draw">Draw Pseudo Nodes</label>
        <input type="checkbox" id="debug_draw"/>
      </div>
      <div class="setting">
        <label for="spacing_x">Spacing X</label>
        <input type="text" id="spacing_x" value="15"/>
      </div>
      <div class="setting">
        <label for="spacing_y">Spacing Y</label>
        <input type="text" id="spacing_y" value="35"/>
      </div>
      <div class="setting">
        <label for="reduce_crossings">Reduce Crossings</label>
        <input type="checkbox" id="reduce_crossings"/>
      </div>
      <div class="setting">
        <label for="optimize_ranking">Optimize Ranking</label>
        <input type="checkbox" id="optimize_ranking"/>
      </div>
      <div class="setting">
        <label for="position_vertices">Position Vertices</label>
        <input type="checkbox" id="position_vertices"/>
      </div>
      <div class="setting">
        <label for="position_edges">Position Edges</label>
        <input type="checkbox" id="position_edges"/>
      </div>


      <button type="button" id="button_layout">Layout</button>
    </div>

    <script type="module">
      import { makeEllipse } from './drawing.mjs'
      import { layout } from './layout.mjs'
      import { Manipulator } from './manipulator.mjs'
        
      document.querySelectorAll('svg .layout text').forEach(makeEllipse)
      document.querySelectorAll('svg .edge').forEach(element => {
        element.onmouseover = () => {
          if (!element.classList.contains("mouseover_edge"))
            element.classList.add("mouseover_edge")
        }
        element.onmouseout = () => {
          element.classList.remove("mouseover_edge")
        }
      })

      document.querySelector('#button_layout').addEventListener('click', ()=>{
        document.querySelectorAll('svg .layout').forEach(svg => {
          let debug_draw
          if (document.querySelector('#debug_draw').checked) {
            debug_draw = svg
          } else {
            debug_draw = false
          }
          let params = {
            debug_draw: debug_draw,
            spacing_x: Number(document.querySelector('#spacing_x').value),
            spacing_y: Number(document.querySelector('#spacing_y').value),
            position_vertices: document.querySelector('#position_vertices').checked,
            position_edges: document.querySelector('#position_edges').checked,
            optimize_ranking: document.querySelector('#optimize_ranking').checked,
            reduce_crossings: document.querySelector('#reduce_crossings').checked,
          }
          layout(svg, params)
        })
      })

      document.querySelectorAll('svg .layout').forEach(svg => {
        //new Manipulator(svg)
      })
    </script>
  </body>
</html>
